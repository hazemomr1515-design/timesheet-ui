<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Timesheet Mock (Plain)</title>
  <style>
    :root { --bg:#f5f5f5; --card:#fff; --text:#222; --muted:#777; --primary:#1677ff; }
    body { margin:0; font-family:system-ui,Segoe UI,Arial; background:var(--bg); color:var(--text); }
    .container { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
    .card { background: var(--card); border-radius: 10px; padding: 16px 16px 8px; box-shadow: 0 2px 10px rgba(0,0,0,.05); }
    h1 { margin: 0 0 12px; font-size: 22px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; margin-bottom:12px; }
    .field { display:flex; flex-direction:column; gap:6px; min-width:180px; }
    label { font-size: 13px; color: var(--muted); }
    input, select, textarea { padding:10px; border:1px solid #ddd; border-radius:8px; font-size:14px; background:#fff; width:100%; }
    textarea { resize: vertical; min-height: 40px; }
    .btn { background:var(--primary); color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; }
    .btn-outline { background:#fff; color:var(--primary); border:1px solid var(--primary); }
    table { width:100%; border-collapse: collapse; font-size:14px; }
    th, td { border-bottom:1px solid #eee; padding:8px; vertical-align:top; }
    th { text-align: start; color:var(--muted); font-weight:600; }
    tfoot td { font-weight:700; }
    .switch { display:inline-flex; gap:8px; border:1px solid #ddd; border-radius:8px; padding:4px; }
    .switch button { border:none; padding:6px 10px; border-radius:6px; background:#fff; cursor:pointer; }
    .switch .active { background: var(--primary); color:#fff; }
    .muted { color: var(--muted); }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="row" style="justify-content:space-between; align-items:center;">
        <h1 id="title">نموذج التايم شيت</h1>
        <div class="switch" aria-label="language">
          <button id="btn-ar" class="active">عربي</button>
          <button id="btn-en">English</button>
        </div>
      </div>

      <div class="row">
        <div class="field" style="min-width:120px">
          <label id="l-entityCode">كود الجهة</label>
          <input id="entityCode" placeholder="مثال: 101"/>
        </div>
        <div class="field" style="min-width:200px">
          <label id="l-entityType">نوع الجهة</label>
          <input id="entityType" readonly/>
        </div>
        <div class="field" style="min-width:260px; flex:1">
          <label id="l-entityName">اسم الجهة</label>
          <input id="entityName" readonly/>
        </div>
      </div>

      <div class="row">
        <div class="field" style="min-width:260px">
          <label id="l-project">المشروع</label>
          <select id="project"></select>
        </div>
        <div class="field" style="min-width:200px">
          <label id="l-activity">النشاط</label>
          <select id="activity">
            <option>Development</option><option>Support</option><option>Meeting</option>
            <option>Training</option><option>Analysis</option><option>Testing</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="field" style="flex:1">
          <label class="muted" id="l-grid">ساعات الأسبوع</label>
          <div style="overflow:auto">
            <table id="grid">
              <thead>
                <tr>
                  <th id="h-sun">الأحد</th>
                  <th id="h-mon">الإثنين</th>
                  <th id="h-tue">الثلاثاء</th>
                  <th id="h-wed">الأربعاء</th>
                  <th id="h-thu">الخميس</th>
                  <th id="h-comment">ملاحظة</th>
                </tr>
              </thead>
              <tbody id="grid-body">
                <tr>
                  <td><input type="number" min="0" step="0.5" class="inp-hours"/></td>
                  <td><input type="number" min="0" step="0.5" class="inp-hours"/></td>
                  <td><input type="number" min="0" step="0.5" class="inp-hours"/></td>
                  <td><input type="number" min="0" step="0.5" class="inp-hours"/></td>
                  <td><input type="number" min="0" step="0.5" class="inp-hours"/></td>
                  <td><textarea placeholder=""></textarea></td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="6" id="total">إجمالي الأسبوع: 0</td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>

      <div class="row">
        <button class="btn" id="btn-add">إضافة صف</button>
        <button class="btn btn-outline" id="btn-save">حفظ مسودة (محلي)</button>
      </div>
    </div>
  </div>

  <script>
    // i18n بسيط
    const t = {
      ar: {
        title:'نموذج التايم شيت', entityCode:'كود الجهة', entityType:'نوع الجهة', entityName:'اسم الجهة',
        project:'المشروع', activity:'النشاط', grid:'ساعات الأسبوع',
        sun:'الأحد', mon:'الإثنين', tue:'الثلاثاء', wed:'الأربعاء', thu:'الخميس',
        comment:'ملاحظة', addRow:'إضافة صف', saveDraft:'حفظ مسودة (محلي)', total:'إجمالي الأسبوع'
      },
      en: {
        title:'Timesheet Mock', entityCode:'Entity Code', entityType:'Entity Type', entityName:'Entity Name',
        project:'Project', activity:'Activity', grid:'Weekly Hours',
        sun:'Sun', mon:'Mon', tue:'Tue', wed:'Wed', thu:'Thu',
        comment:'Comment', addRow:'Add Row', saveDraft:'Save Draft (Local)', total:'Total Week'
      }
    };
    let lang = 'ar';

    const PROJECTS = [
      'Government Payment System','Payroll','Hyperion','Cash Collection','GOV-POS',
      'مشروع التحصيل الإلكتروني للمصروفات الجامعية','Core Taxation','E-Receipt','Time Entries'
    ];

    const el = (id)=>document.getElementById(id);
    function applyLang(){
      const L = t[lang];
      el('title').textContent = L.title;
      el('l-entityCode').textContent = L.entityCode;
      el('l-entityType').textContent = L.entityType;
      el('l-entityName').textContent = L.entityName;
      el('l-project').textContent = L.project;
      el('l-activity').textContent = L.activity;
      el('l-grid').textContent = L.grid;
      el('h-sun').textContent = L.sun;
      el('h-mon').textContent = L.mon;
      el('h-tue').textContent = L.tue;
      el('h-wed').textContent = L.wed;
      el('h-thu').textContent = L.thu;
      el('h-comment').textContent = L.comment;
      el('btn-add').textContent = L.addRow;
      el('btn-save').textContent = L.saveDraft;
      document.documentElement.dir = (lang==='ar'?'rtl':'ltr');
      document.documentElement.lang = lang;
      updateTotal();
    }

    // مشاريع
    const projectSel = el('project');
    PROJECTS.forEach(p=>{
      const o = document.createElement('option'); o.textContent = p; o.value = p; projectSel.appendChild(o);
    });

    // حساب الإجمالي
    function updateTotal(){
      const inputs = document.querySelectorAll('.inp-hours');
      let sum = 0;
      inputs.forEach(i => sum += Number(i.value || 0));
      el('total').textContent = (lang==='ar'?'إجمالي الأسبوع: ':'Total Week: ') + sum;
    }
    document.addEventListener('input', (e) => {
      if (e.target.classList.contains('inp-hours')) updateTotal();
    });

    // سويتش اللغة
    el('btn-ar').onclick = ()=>{ lang='ar'; el('btn-ar').classList.add('active'); el('btn-en').classList.remove('active'); applyLang(); };
    el('btn-en').onclick = ()=>{ lang='en'; el('btn-en').classList.add('active'); el('btn-ar').classList.remove('active'); applyLang(); };

    // إضافة صف
    el('btn-add').onclick = ()=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="number" min="0" step="0.5" class="inp-hours"/></td>
        <td><input type="number" min="0" step="0.5" class="inp-hours"/></td>
        <td><input type="number" min="0" step="0.5" class="inp-hours"/></td>
        <td><input type="number" min="0" step="0.5" class="inp-hours"/></td>
        <td><input type="number" min="0" step="0.5" class="inp-hours"/></td>
        <td><textarea></textarea></td>`;
      document.getElementById('grid-body').appendChild(tr);
    };

    // حفظ محلي
    el('btn-save').onclick = ()=>{
      const hours = Array.from(document.querySelectorAll('#grid-body tr')).map(tr=>{
        const nums = tr.querySelectorAll('.inp-hours');
        return {
          sun: Number(nums[0].value||0), mon: Number(nums[1].value||0), tue:Number(nums[2].value||0),
          wed:Number(nums[3].value||0), thu:Number(nums[4].value||0),
          comment: tr.querySelector('textarea').value||''
        };
      });
      const data = {
        entityCode: el('entityCode').value,
        entityType: el('entityType').value,
        entityName: el('entityName').value,
        project: projectSel.value,
        activity: el('activity').value,
        hours
      };
      localStorage.setItem('timesheetDraft', JSON.stringify(data));
      alert(lang==='ar'?'تم الحفظ محلياً':'Saved locally');
    };

    // Lookup بسيط من entities.csv إذا وُجد
    el('entityCode').addEventListener('change', async ()=>{
      try {
        const res = await fetch('./entities.csv');
        if (!res.ok) return;
        const text = await res.text();
        const [head, ...rows] = text.split(/\r?\n/).filter(Boolean);
        const idx = head.split(',').map(h=>h.trim().toLowerCase());
        const ci = idx.indexOf('code'), ti = idx.indexOf('type'), ni = idx.indexOf('name');
        const found = rows.map(r=>r.split(',')).find(p => (p[ci]||'').trim() === el('entityCode').value.trim());
        if (found) { el('entityType').value = (found[ti]||'').trim(); el('entityName').value = (found[ni]||'').trim(); }
        else { el('entityType').value=''; el('entityName').value=''; }
      } catch {}
    });

    applyLang();
  </script>
</body>
</html>
